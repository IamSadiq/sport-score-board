<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Match Score Board</title>

    <link rel="stylesheet" href="./css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <div style="height:100px;background-color: #000;color:#fff;">
            <h1 class="text-center">MATCH SCORE BOARD</h1>
        </div>
        
        <hr>

        <span class="text-center">
            <label for="form3">SELECT ACCOUNT</label>
            <select v-model="account" id="acct" class="form-control">
                <option value="0">Account 0</option>
                <option value="1">Account 1</option>
                <option value="2">Account 2</option>
                <option value="3">Account 3</option>
                <option value="4">Account 4</option>
                <option value="5">Account 5</option>
                <option value="6">Account 6</option>
                <option value="7">Account 7</option>
                <option value="8">Account 8</option>
                <option value="9">Account 9</option>
            </select>
        </span>
        <hr>

        <div class="row">
            <span class="col-md-1"></span>
            <input type="text" class="col-md-2 form-control" v-model="match.teamA" placeholder="Team A" required>
            <input type="number" class="col-md-2 form-control" v-model="match.teamAScore" placeholder="Score" required>

            <span class="col-md-1"></span>
            <span> vs </span>
            <span class="col-md-1"></span>
            
            <input type="number" class="col-md-2 form-control" v-model="match.teamBScore" placeholder="Score" required>
            <input type="text" class="col-md-2 form-control" v-model="match.teamB" placeholder="Team B" required>
            <span class="col-md-1"></span>
        </div>

        <br>
        <div class="row">
            <span class="col-md-3"></span>
            <input type="text" class="col-md-2 form-control" v-model="match.sport" placeholder="Sport" required>
            <span class="col-md-2"></span>
            <input type="text" class="col-md-2 form-control" v-model="match.tournament" placeholder="Tournament" required>
            <span class="col-md-3"></span>
        </div>
        <br>
        <center><button class="col-md-2 btn btn-primary text-center" v-on:click="addMatch(match)">ADD MATCH</button></center>

        <br>
        <hr>
        <h4 class="text-center">Recent Matches</h4>
        <hr>

        <div id="all-matches">
            <!-- SAMPLE MATCH RECORD 1 -->
            <div class="row">
                <span class='col-md-2'><b>Football</b></span>
                <span class='col-md-2'>Chelsea</span>
                <span class='col-md-1'>3</span>
                <span class='col-md-1'>vs</span>
                <span class='col-md-2'>1</span>
                <span class='col-md-2'>Liverpool</span>
                <span class='col-md-2'><b>Premier League</b></span>
                <!-- <span class='col-md-2'><script>Date.now();</script></span> -->
            </div>

            <br>
            <!-- SAMPLE MATCH RECORD 2 -->
            <div class="row">
                <span class='col-md-2'><b>Football</b></span>
                <span class='col-md-2'>Barcelona</span>
                <span class='col-md-1'>5</span>
                <span class='col-md-1'>vs</span>
                <span class='col-md-2'>0</span>
                <span class='col-md-2'>Real Madrid</span>
                <span class='col-md-2'><b>La Liga</b></span>
                <!-- <span class='col-md-2'><script>Date.now();</script></span> -->
            </div>
        </div>
        
    </div>

    <!-- Web3 -->
    <script src="./js/web3.min.js"></script>
    <!-- Vue -->
    <script src="./js/2.4.2/vue.min.js"></script>
    <!-- App -->

    <script type="text/javascript">

        var web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
        var account = parseInt(document.getElementById('acct').value);

        web3.eth.defaultAccount = web3.eth.accounts[account];
        // console.log(web3.eth.accounts);
        console.log(web3.eth.defaultAccount);

        // import { default as contract } from 'truffle-contract';

        // Import our contract artifacts and turn them into usable abstractions.
        import ScoreBoardArtifact from '../build/contracts/MatchScoreBoard.json'

        // MatchScoreBoard is our usable abstraction, which we'll use through the code below.
        const MatchScoreBoard = web3.eth.contract(ScoreBoardArtifact)

        // need to get the smart contract abi and paste as args
        var contractAbi = web3.eth.contract([[Object], [Object], [Object], [Object], [Object], [Object],[Object],[Object],[Object],[Object],[Object],[Object],[Object]],createMatch:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound],getData: [Function: bound],'string,string,uint256,uint256,string,string,string': [Circular]},getMatch:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound],getData: [Function: bound],bytes32: [Circular]},getAllMatches:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound]getData: [Function: bound],'': [Circular]},setMatchScore:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound],getData: [Function: bound],'bytes32,uint256,uint256': [Circular]},getMatchScore:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound],getData: [Function: bound],bytes32: [Circular]},setSportType:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound],getData: [Function: bound],'bytes32,string': [Circular]},getSportType:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound],getData: [Function: bound],bytes32: [Circular]},setTournament:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound],getData: [Function: bound],'bytes32,string': [Circular]},getTournament:{[Function: bound ]request: [Function: bound],call: [Function: bound],sendTransaction: [Function: bound],estimateGas: [Function: bound],getData: [Function: bound],bytes32: [Circular]},allEvents: [Function: bound],CreatedNewMatch:{[Function: bound ]'string,string,uint256,uint256,string,string,string,bytes32': [Function: bound]},AddedMatchScore: { [Function: bound ]'string,string,uint256,uint256,bytes32': [Function: bound] },AddedSportType: { [Function: bound ]'string,string,string,bytes32': [Function: bound] },AddedMatchTournament: { [Function: bound ]'string,string,string,bytes32': [Function: bound] } },CreatedNewMatch:{[Function: bound]'string,string,uint256,uint256,string,string,string,bytes32': [Function: bound]},AddedMatchScore: { [Function: bound] 'string,string,uint256,uint256,bytes32': [Function: bound] },AddedSportType: { [Function: bound] 'string,string,string,bytes32': [Function: bound] },AddedMatchTournament: { [Function: bound] 'string,string,string,bytes32': [Function: bound] },createMatch:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]},getMatch:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]},getAllMatches:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]},setMatchScore:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]},getMatchScore:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]},setSportType:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]},getSportType:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]},setTournament:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]},getTournament:{[Function]call: [Function],sendTransaction: [Function],request: [Function: bound],estimateGas: [Function]});

        // need to get the smart contract address and paste as args
        var contractInstance = contractAbi.at('0xdd00bcd58adc8342c5a94b58423de6b98755dfd5');

        var score_board = new Vue({
            el: '.container',
            data: {
                allMatches: [],
                match: {
                    teamA: '',
                    teamB: '',
                    teamAScore: 0,
                    teamBScore: 0,
                    sport: '',
                    tournament: '',
                    createdAt: '',
                },
                selected: false,
                matchId: ''
            },
            computed: {
                accountSelected: function () {
                    return this.selected;
                }
            },
            methods: {
                addMatch: function (match) {
                    let scoreBoard;
                    MatchScoreBoard.deployed().then(function (instance) {
                        scoreBoard = instance
                    });

                    match.createdAt = Date.now();
                    this.scoreBoard.createMatch(match.teamA, match.teamB, match.teamAScore, match.teamBScore, match.sport, match.tournament, match.createdAt);
                    console.log(match.teamA + " " + match.teamAScore + " vs " + match.teamBScore + " " + match.teamB);
                },

                getMatches: function () {
                    let scoreBoard;
                    MatchScoreBoard.deployed().then(function (instance) {
                        scoreBoard = instance
                    });

                    this.allMatches = this.scoreBoard.getAllMatches();

                    this.allMatches.forEach(elem => {
                        var element = elem.toLocaleString();
                        this.scoreBoard.getMatch(function (element) {
                            document.getElementById('all-matches').innerHTML = "<div class='row'>" +
                                "<span class='col-md-2'><b>" + element[4] + "</b></span>" +
                                "<span class='col-md-2'>" + element[0] + "</span>" +
                                "<span class='col-md-1'>" + element[2] + "</span>" +
                                "<span class='col-md-1'> vs </span>" +
                                "<span class='col-md-2'>" + element[3] + "</span>" +
                                "<span class='col-md-2'>" + element[1] + "</span>" +
                                "<span class='col-md-2'><b>" + element[5] + "</b></span>" +
                                "</div>";
                                // "<span class='col-md-2'>" + element[6] + "</span>";
                        });
                    });
                }
            }
        });

        this.score_board.getMatches();
    </script>
</body>

</html>